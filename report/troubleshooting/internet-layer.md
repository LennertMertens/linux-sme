# Internet Layer

## Checklist: Internet Layer
1. Local network configuration 
2. Routing within LAN

**Know the expeced values!**

## 1. Checking Local Network Configuration:
Every interface should have set:
1. IP address: `ip a`
2. Default gateway: `ip r`
3. DNS service: `/etc/resolv.conf`

### Local Configuration: IP address
* IP address?
* In correct subnet?
* DHCP or fixed IP?
* Check configuration: `/etc/sysconfig/network-scripts/ifcfg-*`
    * e.g. checking eth0: `cat /etc/sysconfig/network-scripts/ifcfg-eth0`
* Restarting network interfaces: `systemctl restart network`

#### Example DHCP: 
```bash
TYPE=Ethernet   
BOOTPROTO=dhcp  # Should be DHCP
NAME=enp0s3     
DEVICE=enp0s3   # Should be the interface name
ONBOOT=yes      # should be yes, or the interface will not attempt to activate the interface on boot, or when restarting the network interfaces (systemctl restart network)
```

#### Example: Static IP
```bash
BOOTPROTO=none
ONBOOT=yes
IPADDR=192.168.56.73    # Must be specified as required
NETMASK=255.255.255.0   # Must be specified as required
DEVICE=enp0s8

```

### Common Causes (DHCP)
* No IP
    * DHCP unrachable
    * DHCP won't give an IP
* 169.254.x.x APIPA
    * No DHCP offer"link-local" address
* Unexpected subnet
    * Bad config (fixed IP set?)

Watch the logs: `sudo journalctl -f`

### Common Causes (Fixed IP)
* Unexpected subnet
    * Check config
* Correct IP, "network unreachable"
    * Check network mask

### Default Gateway
command: `ip r` 
- There should be a line starting with default via x.y.z.w.

Possible problems and causes (automatic IP assignment with DHCP):
- No default gateway set
- there is most probably also a problem with the IP address of this host, fix this first
- You may have accidentally set the default gateway manually previously and forgot to set it to DHCP again
- If you manage the DHCP server, maybe itâ€™s configured badly?

### DNS server: /etc/resolv.conf
* `nameserver` option present?
* Expected IP?

Output should look like this: 

```
$ cat /etc/resolv.conf
# Generated by NetworkManager
search hogent.be
nameserver 193.190.173.1
nameserver 193.190.173.2
```


## 2. Checking routing within the LAN
* Ping between hosts 
* Ping default GW/DNS
* Query DNS: 
    * `dig`
    * `nslookup`
    * `getent`: displays entries from databases supported by the
       Name Service Switch libraries, which are configured in
       /etc/nsswitch.conf.

### LAN Connectivity: ping
- host -> VM: `ping 192.168.56.72`
- VM -> host: `ping 192.168.56.1`
- VM -> GW: `ping 10.0.2.2`
- VM -> DNS: `ping 10.0.2.3`

**Remark: some routers block ICMP!**

### LAN connectivity: DNS
- `dig icanhazip.com`
- `nslookup icanhazip.com`
- `getent ahosts icanhazip.com`

Next step: troubleshoot [Transport Layer](transport-layer.md)